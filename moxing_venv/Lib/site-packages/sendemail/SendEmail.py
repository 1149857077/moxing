# -*- coding: utf-8 -*-
# Time    : 2019/4/25 21:32
# Author  : Amd794
# Email   : 2952277346@qq.com
# Github  : https://github.com/Amd794


# 发送邮件
import random
import smtplib
from sendemail.ConstructEmail import ConstructEmail
from sendemail.setting import from_addr, to_addr, password, smtp_server


class SendEmail():
    '''
        发送邮件类
    '''
    def __init__(self, content, title, emtype='textConnent', path=''):
        self.ConstructEmail = ConstructEmail()
        self.content = content
        self.title = title
        self.emtype = emtype
        self.path = path

    # TODO 发送的邮件类型
    def __emailType(self):
        emtypes = {
            'textConnent': self.ConstructEmail.textConnent,
            'htmlcontent': self.ConstructEmail.htmlcontent,
        }
        return emtypes.get(self.emtype, 'textConnent')

    # TODO 发送邮件
    def sendEmail(self):
        m = self.__emailType()
        msg = m(from_addr, to_addr, self.content, self.title)
        if self.path:
            msg = self.ConstructEmail.annex(self.path, msg, from_addr, to_addr, self.title)
        server = smtplib.SMTP(smtp_server, 25)
        server.set_debuglevel(1)
        server.login(from_addr, password)
        server.sendmail(from_addr, [to_addr], msg.as_string())
        server.quit()
        print('发送成功...')


if __name__ == '__main__':
    content = '<h1 style="color: skyblue; font-size: 48px>">正文html</h1>'
    title = '标题'
    sendEmail = SendEmail(content, title, 'htmlcontent', '../imgs/336.jpg')
    sendEmail.sendEmail()
